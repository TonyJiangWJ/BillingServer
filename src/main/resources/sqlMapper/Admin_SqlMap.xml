<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.tony.dao.AdminDao">
    <sql id="all">
        id id,
        tokenId tokenId,
        tokenVerify tokenVerify,
        code code,
        userName userName,
        password password,
        lastLogin lastLogin,
        createTime createTime,
        modifyTime modifyTime,
        version version,
        isDeleted isDeleted
    </sql>
    <update id="doLogin" parameterType="com.tony.entity.Admin">
        UPDATE t_admin
        SET lastLogin   = #{lastLogin,jdbcType=TIMESTAMP},
            tokenId     = #{tokenId,jdbcType=VARCHAR},
            tokenVerify = #{tokenVerify,jdbcType=BIGINT}
        WHERE
            userName = #{userName,jdbcType=VARCHAR}
            AND password = #{password,jdbcType=VARCHAR}
            AND isDeleted = 0
    </update>
    <select id="preLogin" parameterType="com.tony.entity.Admin" resultType="com.tony.entity.Admin">
        SELECT
        <include refid="all"/>
        FROM t_admin
        WHERE userName = #{userName,jdbcType=VARCHAR}
        AND password = #{password,jdbcType=VARCHAR}
        AND isDeleted = 0
    </select>
    <select id="loginCheck" resultType="com.tony.entity.Admin" parameterType="String">
        SELECT
        <include refid="all"/>
        FROM t_admin
        WHERE tokenId = #{tokenId} AND isDeleted = 0
    </select>
</mapper>